# Phase 2 Retrospective: Foundational

**Feature**: 001-smile-loop
**Phase**: 2 - Foundational
**Started**: 2026-02-03
**Completed**: 2026-02-03

## Objectives

- Create shared error types (SmileError enum)
- Implement configuration types (Config, StudentBehavior, LlmProvider, PatienceLevel)
- Create Python output models (StudentOutput, Config)
- Build CLI skeleton with clap

## Decisions Made

1. **Error Type Design**: Used thiserror for ergonomic error handling with descriptive messages that include actionable suggestions. Added `is_transient()` and `is_fatal()` helper methods for retry/termination decisions.

2. **Config Serde Strategy**: Used `#[serde(default)]` with explicit default functions to ensure all config fields have sensible values when smile.json is missing or incomplete.

3. **Python/Rust Parity**: Matched field names and enum variants between Rust and Python models. Used snake_case in Python per convention but camelCase in JSON for spec compatibility.

4. **CLI Structure**: Used clap derive macros for declarative argument definition. Deferred actual orchestration to Phase 8.

## Learnings

1. **Strict Clippy Lints**: The workspace denies `unwrap()` and `expect()` even in test code. Need to add `#[allow(clippy::unwrap_used)]` to test modules or use `?` operator with test helper returns.

2. **Raw String Literals**: Clippy warns about unnecessary hashes in raw strings (e.g., `r#"{}"#` should be `r"{}"`).

## Issues Encountered

1. **Test Code Lints**: Initial config.rs tests used `unwrap()` which was caught by pre-commit hooks. Fixed by adding allow attribute to test module.

2. **Working Directory State**: Shell commands can change working directory. Use absolute paths or explicit `cd` to project root when needed.

## Improvements

1. Consider adding a `SmileError::from_io_with_path()` helper that wraps I/O errors with file path context for better error messages.

2. Python tests should be added for output.py and config.py models in later phases.
